# AstrBot 今日人品插件

一个有趣的今日人品测试插件，让你的 AstrBot 成为占卜大师！

## 功能特性

- 📊 **今日人品测试** - 每天测试一次人品值，获得今日运势
- 🏆 **人品排行榜** - 查看群内今日人品排行
- 📈 **历史记录** - 查看个人人品历史和统计信息
- 🔮 **AI 占卜** - 使用大语言模型生成个性化的占卜过程和建议
- 💬 **合并转发** - 支持 QQ 平台的合并转发消息（可选）

## 使用方法

### 基础指令

- `/jrrp` 或 `-jrrp` 或 `今日人品` - 测试今日人品
- `/jrrprank` 或 `人品排行` - 查看群内今日人品排行榜（仅群聊可用）
- `/jrrphistory` 或 `/jrrphi` 或 `人品历史` - 查看个人人品历史记录

### 人品值说明

- 0: 极其倒霉 💀
- 1-2: 倒大霉 😱
- 3-10: 十分不顺 😔
- 11-20: 略微不顺 😐
- 21-30: 正常运气 😊
- 31-98: 好运 🍀
- 99: 极其好运 🎯
- 100: 万事皆允 👑

## 配置说明

插件支持在 AstrBot 管理面板中进行配置：

- **插件总开关** - 启用/禁用插件
- **人品值范围** - 设置人品值的上下限
- **使用 LLM** - 是否使用大语言模型生成占卜过程
- **合并转发** - 是否使用合并转发消息（仅 QQ 平台）
- **转发消息样式** - 选择 merged（合并转发）或 separate（分条发送）
- **自定义提示词** - 自定义占卜过程和建议的生成提示词

### 关于合并转发

由于 AstrBot 的消息处理机制，合并转发功能可能在某些情况下无法正常工作。如果遇到合并转发被拆分的问题，可以尝试：

1. 将 `forward_style` 设置为 `separate`，使用分条发送模式
2. 关闭 `use_forward_message`，使用普通消息格式

## 数据存储

插件数据保存在 `data/daily_fortune/` 目录下：
- `fortunes.json` - 今日人品数据
- `history.json` - 历史记录数据

## 依赖要求

- AstrBot >= 3.4.0
- aiofiles

## 注意事项

1. 每个用户每天只能测试一次人品值
2. 人品排行榜功能仅在群聊中可用
3. 合并转发功能仅支持 QQ 平台（aiocqhttp）
4. 使用 LLM 功能需要配置好大语言模型提供商

## 更新日志

### v0.1.1
- 改进合并转发实现，使用 Nodes 包装器
- 添加分条发送模式作为备选方案
- 优化错误处理和日志记录

### v0.1.0
- 初始版本发布
- 实现基础功能

## 问题排查

如果遇到合并转发被分段的问题：
1. 检查 AstrBot 版本是否支持 Nodes 类型
2. 尝试切换到 separate 模式
3. 查看日志中的错误信息

## 反馈与建议

如有问题或建议，欢迎在 GitHub 仓库提交 Issue。

作者：xSapientia
